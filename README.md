# 猫池短信系统 - 渠道操作用户端

## 🎯 项目简介

这是一款专为渠道操作用户设计的猫池短信发送客户端软件。通过Python + PyQt5开发，支持多端口管理、任务创建执行、实时监控等核心功能。

## ✨ 主要功能

### 🔐 用户认证
- 渠道操作用户登录验证
- MAC地址绑定验证
- 用户积分实时显示（五分钟更新）

### 📋 任务管理
- **创建任务**: 支持短信/彩信任务创建
- **任务控制**: 开始、暂停、重试失败消息
- **任务编辑**: 修改任务名称、主题、内容
- **任务测试**: 单条测试发送验证
- **结果导出**: 导出已完成/未完成消息明细
- **任务删除**: 软删除任务管理

### 🔌 端口管理
- **自动扫描**: 检测可用COM端口
- **状态监控**: 实时显示端口状态和运营商信息
- **智能控制**: 端口选择、启动、停止管理
- **统计清除**: 发送统计数据管理

### 📊 监控功能
- **实时进度**: 任务执行进度实时更新
- **发送统计**: 成功、失败数量统计
- **监测提醒**: 发送指定条数后自动检测提醒
- **积分管理**: 自动积分扣除和余额监控

## 💻 系统要求

- **操作系统**: Windows 7/10/11 (64位)
- **Python版本**: Python 3.8+
- **数据库**: PostgreSQL 12+
- **硬件要求**: 
  - 内存: 4GB以上
  - 硬盘: 2GB以上可用空间
  - USB端口: 支持多个猫池设备连接

## 🚀 快速开始

### 1. 环境准备

```bash
# 克隆项目
git clone <repository-url>
cd catpool_sms_client

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置环境

```bash
# 复制环境配置文件
cp .env.example .env

# 编辑配置文件，设置数据库连接等信息
notepad .env  # Windows
nano .env     # Linux/Mac
```

### 3. 运行程序

```bash
# 启动应用
python app.py
```

## 📁 项目结构

```
catpool_sms_client/
├── app.py                      # 主程序入口
├── config/                     # 配置管理
├── database/                   # 数据库连接
├── models/                     # 数据模型
├── services/                   # 业务逻辑
├── core/                       # 核心功能
├── ui/                         # 用户界面
├── static/                     # 静态资源
├── temp/                       # 临时文件
└── tests/                      # 测试文件
```

## 🎨 使用说明

### 登录系统
1. 启动程序后，输入操作用户名和密码
2. 系统将验证MAC地址绑定
3. 登录成功后进入主界面，显示用户积分

### 端口管理
1. 程序自动扫描可用COM端口
2. 显示端口状态、运营商信息、发送统计
3. 支持端口批量选择和控制操作

### 任务管理
1. **创建任务**: 点击"添加任务"，填写任务信息
   - 任务名称、目标号码
   - 短信模板、号码模式
   - 主题（彩信）、短信内容
2. **执行任务**: 选择任务，点击"开始任务"
3. **监控进度**: 实时查看发送进度和状态
4. **任务操作**:
   - 🟢 开始任务 - 启动任务执行
   - ⏸️ 暂停任务 - 暂停任务执行
   - 🔄 重试失败 - 重新发送失败消息
   - 🧪 测试任务 - 发送测试短信
   - ✏️ 修改内容 - 编辑任务信息
   - 📤 导出已完成 - 导出成功消息明细
   - 📤 导出未完成 - 导出失败/待发送明细
   - 🗑️ 删除任务 - 软删除任务

### 配置选项
1. 点击"选项"按钮打开配置对话框
2. **选项配置**:
   - 发送间隔: 设置发送间隔时间（毫秒）
   - 卡片更换: 设置发送多少条后需要清除记录
3. **监测设置**:
   - 发送成功: 设置达到多少条后进行监测提醒
   - 监测号码: 设置接收监测短信的号码

## ⚙️ 配置说明

### 环境变量配置 (.env)
```bash
# 数据库配置
DB_HOST=localhost
DB_PORT=5432
DB_NAME=sms_pool_system
DB_USER=postgres
DB_PASSWORD=your_password

# 应用配置
APP_NAME=猫池短信系统
DEBUG=false
LOG_LEVEL=INFO

# 发送配置
DEFAULT_SEND_INTERVAL=1000    # 默认发送间隔(毫秒)
DEFAULT_RETRY_COUNT=3         # 默认重试次数
SMS_RATE=1.0                  # 短信费率
MMS_RATE=3.0                  # 彩信费率

# 端口配置
PORT_SCAN_TIMEOUT=5           # 端口扫描超时(秒)
AUTO_PORT_SCAN=true          # 自动端口扫描

# UI配置
WINDOW_DEFAULT_WIDTH=1200     # 默认窗口宽度
WINDOW_DEFAULT_HEIGHT=800     # 默认窗口高度
AUTO_REFRESH_INTERVAL=300     # 积分更新间隔(秒，5分钟)
```

## 🎨 界面预览

### 主界面布局
```
┌─────────────────────────────────────────────────────────────────┐
│ 猫池短信系统          用户: operator001        余额: 积分10000    │
├─────────────────────────────────────────────────────────────────┤
│ 任务管理                    │              端口管理              │
│ ┌─────────────────────────┐ │ ┌─────────────────────────────────┐ │
│ │ [停止发送][添加任务][更多]│ │ │[全选][反选][选项][启动][停止]    │ │
│ │                         │ │ │                                 │ │
│ │ 任务1  50%  100  5  运行 │ │ │ COM1   移动   60   3   可用      │ │
│ │ [开始][暂停][测试][编辑] │ │ │ COM2   联通   60   10  忙碌      │ │
│ │ [重试][导出][删除]       │ │ │ COM3   电信   60   0   离线      │ │
│ │                         │ │ │                                 │ │
│ │ 任务2  25%   50  2  暂停 │ │ │ [清除全部记录][清除当前记录]     │ │
│ │ [开始][暂停][测试][编辑] │ │ │                                 │ │
│ └─────────────────────────┘ │ └─────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 🛠️ 开发技术栈

- **GUI框架**: Python tkinter (内置，无需额外安装)
- **数据库**: PostgreSQL + psycopg2
- **串口通信**: pyserial
- **文件处理**: pandas, openpyxl
- **日志系统**: loguru
- **密码加密**: bcrypt

## 📝 开发规范

### 代码结构
- **MVC架构**: 模型-视图-控制器分离
- **模块化设计**: 功能模块独立开发
- **异步处理**: 避免界面卡顿
- **错误处理**: 完善的异常捕获

### tkinter界面设计原则
- **布局管理**: 使用grid和pack布局
- **响应式设计**: 支持窗口大小调整
- **用户体验**: 直观的操作流程
- **状态反馈**: 实时状态更新

## 🔧 常见问题

### Q: 程序无法启动？
A: 
1. 检查Python版本（需要3.8+）
2. 确认所有依赖包已正确安装
3. 检查数据库连接配置是否正确

### Q: 端口扫描不到设备？
A: 
1. 确认猫池设备驱动已安装
2. 检查USB连接是否正常
3. 确认设备电源开启
4. 在设备管理器中查看COM端口

### Q: 发送失败率高？
A: 
1. 检查SIM卡余额和信号强度
2. 确认短信内容符合运营商规范
3. 调整发送间隔时间
4. 检查端口配置参数

### Q: 积分不更新？
A: 
1. 检查数据库连接状态
2. 确认用户权限正常
3. 查看应用日志文件

### Q: MAC地址验证失败？
A: 
1. 联系管理员绑定当前设备MAC地址
2. 确认网络适配器正常工作
3. 检查MAC地址获取是否正确

## 📊 性能优化

- **数据库连接池**: 复用数据库连接
- **异步处理**: 发送任务后台执行
- **内存管理**: 及时释放不用的资源
- **界面响应**: 使用线程避免界面阻塞

## 🔒 安全特性

- **密码加密**: bcrypt加密存储
- **MAC绑定**: 设备唯一性验证
- **SQL防注入**: 参数化查询
- **日志记录**: 完整的操作审计

## 📄 许可证

本项目仅供学习研究使用，严禁用于违法违规用途。

## 📞 技术支持

如有问题或建议，请联系开发团队。

---

**⚠️ 重要提示**: 
1. 本软件仅供测试研究，严禁用于违法用途
2. 使用前请确保遵守当地法律法规
3. 请合理使用短信发送功能，避免骚扰他人